---
title: 数据平台设计
date: 2014-08-01 14:33:40
tags: [大数据]
categories: [大数据技术]
description: 数据中台设计
---

# 数据平台架构设计

## 1. 总体架构图
![数据中台设计-架构图](images\数据中台\wechat_2025-08-01_151642_565.png)

## 2. 设计理念
### 2.1 核心思想
- **4纵4横设计**：参照杭州市大数据局城市数据集建设构想
- **架构原则**：
  - 分层解耦
  - 实时离线分离  
  - 数据冷热分离
  - 服务化与治理化并行

### 2.2 架构层次
| 层级 | 功能 | 扩展性 |
|------|------|--------|
| 数据源层 | 数据采集接入 | 支持横向扩展 |
| 计算层 | 流批处理 | 支持横向扩展 |  
| 存储层 | 数据持久化 | 支持横向扩展 |
| 服务层 | 数据API服务 | 支持横向扩展 |

## 3. 计算资源设计
### 3.1 Kafka集群
主要考虑：
  1MB/s持续数据流（相当于​​8.4Mbps​​）需应对5倍峰值突发（​​42Mbps​​），且需避免因磁盘I/O瓶颈导致数据积压。 NVMe SSD 有2.5M IOPS 比传统机械的 100-200 高很多。

  可能会有5MB/s的情况， 1KB一条数据得算起， Kafka日志写入需​​≥5000 IOPS。

  NVMe SSD 有2.5M IOPS 支持这样写入。

- **规格配置**：
  - 16核CPU / 64GB内存 2TB NVMe SSD
  - 万兆网卡
- **性能指标**：
  - 支持1MB/s持续流量
  - 峰值5倍扩容能力(5MB/s)
  - 2.5M IOPS高吞吐


### 3.2 Flink集群
1MB/s流相当于​​每秒有10万个事件，单个事件10B，一般时间窗口10分钟，而Flink处理一个事件需要占用1KB的内存，10 万 * 10 * 60s * 1KB =  60G 左右的数据，再结合杂七杂八的 OS缓存（10GB）、JVM堆外内存（15GB）、Flink网络缓冲（8GB） ,总的内存需求 逼近 128GB 

为什么建议2TB硬盘存储的原因。
每日数据量：1MB/s × 86400s = ​​86.4GB​​
Checkpoint保留7天：86.4GB × 7 = ​​605GB​​
RocksDB状态存储放大率（1.5倍）：​​605GB × 1.5 = 908GB​​
​​系统预留​​：OS（100GB）、日志（50GB）、临时文件（50GB）​​→ 最小需求 908 + 100 + 50 + 50 = 1108GB​​
​​若降至1TB SSD​​：每日需清理Checkpoint，​​状态恢复失败率 > 15%​​

- **节点配置**：
  - 8个TaskManager节点，  每台 ​​128GB DDR4 + 2TB NVMe  32核CPU 
  - 16 Slot/节点
- **设计考量**：
  - 并行计算：支持5倍流量突发
  - 内存优化：减少GC延迟
  - 低延迟：端到端<500ms

### 3.3 Spark集群  
- **硬件配置**：
  - 48核CPU / 512GB DDR5内存
  - 6×4TB HDD(RAID5)
- **性能优势**：
  - 比32核提升50%处理效率
  - DDR5提升33%内存带宽
  - 经济存储方案

### ClickHouse高并发查询。
6节点集群（3分片×2副本），每节点 ​​8TB SSD + 64GB RAM​.
1MB/s流相当于每月2.6TB原始数据。​​基于此​​，ClickHouse的10:1列存压缩将有效存储需求降至260GB，结合64GB RAM缓存，使95%查询无需读盘。

8T 用来大规模数据存储。


HDFS持久化存储设计:

批处理层：经济型存储与计算分离​
离线分析需处理月级 ​​2.6TB数据​​，但冷数据访问频率低，HDD吞吐不足易成ETL瓶颈
因 ​​HDD顺序读写带宽200MB/s​​（媲美低端SSD），且 ​​Erasure Coding（EC 6+3）​​ 比三副本节省50%空间，结合 ​​Alluxio内存缓存​​热表，将温数据访问延迟从分钟级降至秒级，平衡成本与性能

5台DataNode，每台 ​​12TB HDD（7200RPM） + 48GB RAM​​
设计依据：HDD阵列+EC提供48TB有效容量，总吞吐1GB/s，满足夜间ETL窗口需求


## 4. 数据存储策略
### 4.1 分级存储设计
| 层级 | 存储方案 | 访问延迟 | 适用场景 | 成本 |
|------|---------|---------|---------|------|
| 热数据 | ClickHouse/Druid | 亚秒级 | 实时看板 | $0.5/GB/月 |
| 温数据 | HDFS+Alluxio | 秒级 | 交互分析 | $0.1/GB/月 |  
| 冷数据 | S3+ZSTD压缩 | 分钟级 | 合规备份 | $0.01/GB/月 |

## 5. 硬件选型原则
![硬件选型的原则](images\数据中台\硬件选型的原则.png)

为保障1MB/s数据流的实时性，​​因​​Kafka生产者需毫秒级持久化，​​故​​选用NVMe SSD——其2.5M IOPS比HDD高25倍，将磁盘延迟压缩至0.1ms内，避免反压。


![数据容量的考虑](images\数据中台\wechat_2025-08-01_153046_617.png)


容量计算的问题:
- 原始数据：1MB/s * 86400 = 86.4GB/日
- 压缩存储：Parquet+ZSTD ≈ 21.6GB/日
一个月存储量: 86.4GB*30 2.6TB的原始数据  
- 3年存储：21.6GB * 1095 ≈ 23.6TB （3副本=70.8TB）


现在来想一下我的各个领域准备的如何:

1. 面试开场 优势介绍 简单介绍自己。
  1. 30人左右的团队搭建和管理能力。
  2. 扎实的技术功底，多年前沿技术的落地经验。
  3. 大赛/企业评奖/开源共享/知识分享输出。获取广阔的视野和海量的技术应用经验。
    大赛: 数据要素大赛/飞书AI训练营。
    企业评奖: 支撑企业评选数据智能工厂，获政府项目奖励300万。
    开源共享: 
      可能会涉及的问题:
        1. 
    知识分享输出: 博客创作，技术经验分享帖子创作。
  4. 党员的信念感和责任感，始终跟随国家政策的脚步，冲在前线。
    技术出海的事情
    疫情支援数据挖掘。

2. 面试题1道必考，关于架构设计。

3. 关于AI 项目的内容，AI数管员。
    当前公司面临数据孤岛，8大独立系统割裂。取数用数效率低下，业务决策依赖手工报表。
    我作为研发总监，契合公司战略，核心目标是打造AI数管员，通过自然语言和系统数据交互，实现一站式解决
      - 跨系统取数/根因分析/趋势预测/指标监控  四大场景。
    我主导设计了 LLM + 双层意图识别 + Rag + Agent 混合架构。

    实现了:
      意图识别层: 开发了线缆行业定制化的意图识别引擎，(BERT微调 + LLM +RAG) ,结合行业/设计以及生成数据，打磨线缆行业标准数据要素集，开发此意图识别引擎。
      数据层: 构建知识图谱赋能的混合引擎(Milvus向量库 + Neo4j图谱网络)，关联设备 - 订单- 工艺参数实体。
      AGENT层: 基于LangChain Agent 开发任务规划期，Planner + Executor ，支持复杂查询动态拆解，自动调用工具生成可解释的分析报告。

    效果，6大车间(同轴/安防/绝缘/护套/编制/网络线)降低3/4的数管数量，年节省人力成本接近200万元。数据获取效率提高80%，关键系统异常分析报告生成效率提高90%。

    可能衍生的一系列问题:
    - 大模型幻觉的问题:

      检索结果来源标注 + 置信度阈值控制 等方式解决。
    - Agent可靠性的问题
    - 数据安全的问题

    为什么大模型服务必用 HTTP/2？​
    HTTP/2 通过二进制分帧、多路复用和头部压缩，彻底解决 HTTP/1.1 的并发限制和性能瓶颈，使大模型服务能以更少资源支撑更高吞吐量，尤其适合API网关部署与流式生成场景。
      

4. 自己企业内部的管理结构以及自己所处的位置。
  技术部负责人，是我的直属领导，是我的资源诉求方，我平级的是技术总监(线缆方面)。合作方有: 综合管理部，生产车间主任，质量总监，

  配合过程:
    我定技术框架，IT给资源保障，技术负责人批预算。
    我负责造工具，质量定义规则，生产用工具。
    我负责搭系统，生产提需求，技术负责人推动变革。
    我主导设计，IT把控安全，业务部门自已用。

  我内部部门分成6个小组，分别是:
  1. 系统集成和运维组(6) 3个实施 + 2个运维 + 1个系统架构师
  2. 数据分析和业务赋能组(4) 2个高级数据分析 + 2个业务数据分析
  3. 数据底座(中台组)(6): 数据架构师 + 高级数据治理 + 数据开发3 + 数据资产运营
  4. 物联网技术和设备组 (5): 物联网平台工程师 + 边缘计算工程师  + 硬件工程师 + 协议适配工程师 + 物联网应用
  5. 安全和测试 安全顾问 1  测试1人
  6.  项目管理和PMO  项目经理2人 产品经理1 人 

  管理的手段和方法:
  最重要的是业绩，所以第一考量必须是目标，比如给我们数字化部门的目标是降本增效 3000万
  1. 目标管理： 团队级别的OKR  + 双周的对齐会议
  2. 根据业务价值量化绩效考核的指标。

  团队内部如何进行管理和决策呢？
  能力成熟度---进行分层管理 + 公司级别的师带徒计划的落实，成员 初级 -> 中级 -> 高级的不断的成长与迭代。
  对于某个目标场景，网格化分工，落实到具体的角色。形成 需求方，执行方，验收方的责任链条。
  内部决策: 我牵头成立技术委员会  + 领域专家制。

  三人最小化验证小组的成立，对于新技术，15%预算投入小规模验证，没有问题后大规模推广。

  团队外部-跨部门协同-业务语言，面向业务的人员是我们的切入点。 实施，业务数据分析，项目经理。他们负责将业务语言转化为技术需求。
  业务即是我们的需求方，也是我们的考核方，目标和考核也与业务的效率的提升目标挂钩。

  人才如何培养和进阶:
    师带徒的战略的紧密融入，部门特色的晋升体系，技术+ 业务两手抓，两维度考核，技术-任务包 业务: 业务汇报
    技术: 提升人员的专业度  业务: 行业归属感 + 公司归属感提升  

  过程监控: 用数字化工具 + 敏捷迭代+ 灰度发布
  飞书多维表格: 进行需求和项目全生命周期管理，需求-设计-开发-测试-上线-交付 设置预警机制。
  大型项目则采用  敏捷迭代+ 灰度发布 

  文化:坚持公司文化+ 互联网文化融合制造。公司: 成为线缆行业的高端客户的首选供应商。


5. 物联网协议方面的和AI相关的问题、多看多记住。


6. 加个卷积神经网络在大模型中的应用相关的问题。 

7. 薪资谈判技巧。


我的核心项目:
1. 数据底座的升级项目-升级大数据
2. AI数管员
3. 工艺产品研发设计管理系统
4. RPA项目


不管如何，我都要聚焦大模型的内容,结合上份工作的内容，多尝试。

可能问到的问题:
你如何设计一个Agent的规划器（Planner），使其能够分解复杂任务并制定有效计划？
  既然谈到Agent的规划器，其实核心目的就是任务的拆解，拆解为子任务，获取数据并进行推理的过程。
  1. 解决拆解不出来的问题: 定义行业或者业务的任务拆解模版。
  2. 别拆解的太深或者陷入死循环: 设置熔断层以及监控。
  3. 关于一些敏感数据的部分，需要调用审批触发的工具或者脱敏才能获取相应的结果。

关于AI比较大的话题，关于落地方面的困难。
最大的困难是ROI, -轻量化垂直方案降低试错成本
长链条错误会被无限的放大的问题 
- 深耕领域，制作强规则引擎，固话关键的逻辑，极致的降低幻觉。
- 发觉大模型的推理能力。

如何监控和评估RAG系统的整体效果？除了最终答案准确性，还关注哪些指标（检索相关度、延迟、成本）？
1. 

卷积神经网络方面的应用:



我的提问:
如何定义这个岗位前6个月的成功？我建议从系统稳定性、团队输出、创新落地三维度衡量?

当前团队面对的最大挑战是什么？

还有抖音上收藏了一些比较通用的内容和话术。应对一些CEO的角色。

脑袋里面还是对整体他们团队的规模和架构不是非常了解。--其实这个应该在初次碰撞中问到的内容。


公司的信息:
国有企业 台州椒江区  三个股东  大股东  城投是最大的股东。

1. 云业务 数据中心  电子政务云 两朵 政务公有云  政务专有云   国资云  
2.  企业  主机托管的业务  机房   7*24 小时   主机托管的服务。  
3. 20年开始  麒麟中标系统   信创  国家的团队  。中美科技战，党政机关  
4. 行业的  电力信创  专业场景 
5. 能源  用能管理  水电气煤。生产电缆的数据的采集。光谱的改造。  
5. 低空 无人机的应用。数据采集。招：研发中心，研发总监，管理能力，专业条件的沟通，技术能力。

用决策逻辑碾压知识储备。尽量避免一问一答的模式，像学生背书，研发总监要展示决策思维。
